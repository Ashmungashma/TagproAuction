
<head>
  <title>Tagpro MLTP Auction</title>
    
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" href="/flat-ui.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="http://elrumordelaluz.github.io/csshake/css/csshake.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script type="text/javascript" src="/jquery-1.11.1.js"></script> 
    <script type="text/javascript" src="/bootstrap.min.js"></script> 
    <script type="text/javascript" src="/flat-ui.min.js"></script> 
    <script type="text/javascript" src="/jquery.vibrate.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript">
        var highlightColor = "rgb(255, 245, 0)";
        var blueColor = "rgb(134, 198, 230)";
        var redColor = "rgb(235, 126, 126)";
        var intime = 150;
        var outtime = 2000;
        var firstLiCheck = 0;

        function animateTeam(name) {
            var team = $("#team_"+name.split(" ").join("_"));
            var grandparent = team.parent().parent();

            grandparent.addClass("shake shake-constant");
            setTimeout(function () {
                grandparent.removeClass("shake shake-constant")
            }, outtime*2);
            /*
            color = '';
            if(team.css("background-color") === redColor) {
                color = redColor;
            }
            else {
                color = blueColor;
            }
            team.animate({backgroundColor:highlightColor}, intime, 
                function () {
                    team.animate({backgroundColor:color}, outtime); 
            });
            */
            var canVibrate = "vibrate" in navigator || "mozVibrate" in navigator;
            if (canVibrate && !("vibrate" in navigator))
                navigator.vibrate = navigator.mozVibrate;
            if(canVibrate) {
                $("#vibrate").vibrate({
                    pattern: [200, 400, 200]
                });
                $("#vibrate").click();            
            }
        }

        function checkForAnimation() {
            if(firstLiCheck == 0) {
                $(".winningTeam").remove();
                firstLiCheck = 1;
            }
            else {
                if($(".winningTeam").length == 1) {
                    teamname = $(".winningTeam").html().split("] ")[1];
                    console.log(teamname);
                    animateTeam(teamname);
                    $(".winningTeam").remove();
                }
                else {
                    $(".winningTeam").remove();
                }
            }
        }
        setInterval(checkForAnimation, 1000);



        var substringMatcher = function(strs) {
          return function findMatches(q, cb) {
            var matches, substrRegex;
         
            // an array that will be populated with substring matches
            matches = [];
         
            // regex used to determine if a string contains the substring `q`
            substrRegex = new RegExp(q, 'i');
         
            // iterate through the pool of strings and for any string that
            // contains the substring `q`, add it to the `matches` array
            $.each(strs, function(i, str) {
              if (substrRegex.test(str)) {
                // the typeahead jQuery plugin expects suggestions to a
                // JavaScript object, refer to typeahead docs for more info
                matches.push({ value: str });
              }
            });
         
            cb(matches);
          };
        };

        playerData = ["Mercury", "Venus", "Earth", "Mars", "Jupiter", "Saturn", "Uranus", "Neptune"];
        /*$('#playerSearch').typeahead({
            hint: true,
            highlight:true,
            minLength: 1},
            {
            name: 'players',
            displayKey: 'value',
            source: playerData
            }
        );*/

    </script>
</head>

<body>
    <div class="container-fluid">
    <div id="fixme">
        <nav class="navbar navbar-default" role="navigation" style="width:100%;">
            <ul class="nav navbar-nav navbar-right">
            <li style="margin-right:20px;">{{> funds_remaining}}</li>
            <li style="margin-right:20px;"><p class="navbar-text">{{> loginButtons align="right"}}</p></li>
            </ul>
        </nav>
        </div>
        <div class="row" style="padding-top:25px;">
            <div class="col-sm-4 col-sm-push-8 col-xs-12" style="padding-top:0px;">
                {{> display_bidding_options}}
                {{> display_time}}
                {{> messages}}
            </div>
            <div class="col-sm-8 col-sm-pull-4 col-xs-12">
                {{> rosters}}
            </div>
        </div>
        <div class="button" id="vibrate" style="display:hidden"></div>
    </div>
</body>

<template name="messages">
<div class="row">
    <div class="col-sm-10 col-sm-offset-1 col-xs-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            {{#if canSendMessage}}
                <form class="form-inline new-post" role="form">
                        <input type="text" class="form-control" name="text" placeholder="Type a message" style="width:83%">
                        <button class="btn btn-primary" type="submit">Send</button>
                </form>
            {{else}}
                Log in to Chat
            {{/if}}
        </div>
        <ul class="list-group" id="messageLog" style="height: 500px; overflow: scroll;overflow-x: hidden;">
            {{#each messages}}
                {{#if text}}
                    <li class="list-group-item {{messageColor messageType}}" style="word-break: break-all;">{{text}}</li>
                {{/if}}
            {{/each}}
        </ul>
    </div>
</div>
</div>
</template>

<template name="funds_remaining">
{{#if isCaptain}}
        <p class="navbar-text navbar-right">Balance: <b>{{getBalance}}</b></p>
{{/if}}
</template>


<template name="rosters">
    <div class="row" style="padding-top:30px;">
      {{#each divisions}}
              <div class="col-md-2"></div>
              {{#each teams division ./division}}
                 <div class="col-lg-2 col-md-4 col-sm-6 col-xs-12 team" style="">
                        <ul class="list-group">
                        <li class="list-group-item" id="team_{{teamID teamname}}" style="text-align:center;background-color:{{inRedDivision division}}">
                            {{teamname}} 
                            <br>
                            {{money}}
                        </li>
                        {{#each players teamname ./teamname}}
                            <li class="list-group-item" style="padding: 2px 2px; height:25px">
                            <span style="width:20px; display:inline-block;">
                            {{#if captain}}
                                <img src="/captain.png">
                            {{else}}
                                {{#if cocaptain}}
                                    <img src="/cocaptain.png">
                                {{else}}
                                    {{#if mltp}}
                                        <img src="/MLTP.png">
                                    {{else}}

                                    {{/if}}
                                {{/if}}
                            {{/if}}
                            </span>
                            {{#if name}}
                                {{name}}
                                <div style="float:right; padding-right:8px">
                                {{cost}}
                                </div>
                            {{/if}}
                            </li>
                            {{/each}}
                        </ul>
                    </div>
              {{/each}}
              <div class="clearfix visible-sm visible-md visible-lg"></div>
      {{/each}}
    </div>
</template>

<template name="display_bidding_options">
    {{#if isCaptain}}
    <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
        <div class="panel panel-default">
        <div class="panel-heading">
        {{#if isNominationTime}}
            {{#if isTurnToNominate}}
                <form class="form-inline nominate-player" role="form">
                        <input type="text" name="player" class="form-control" id="playerSearch" list="players" placeholder="Input a player name" />
                        <datalist id="players" style="display:hidden">
                            <option value="Internet Explorer"></option>
                            <option value="Firefox" ></option>
                            <option value="Chrome" ></option>
                            <option value="Opera" ></option>
                            <option value="Safari" ></option>
                        </datalist>

                        <input type="text" name="amount" class="form-control" placeholder="Initial bid (blank = 0)" />
                        <button type="submit" class="btn btn-success">Nominate</button>
                </form>
            {{else}}
                <form class="form-inline bid-on-player" role="form">
                        <input type="text" disabled name="amount" class="form-control" placeholder="Waiting for nomination" style="width:83%">
                        <button type="submit" disabled class="btn btn-success">Bid</button>
                </form>
            {{/if}}
        {{else}}
            {{#if sufficientFunds}}
            <form class="form-inline bid-on-player">
                <input type="text" class="form-control" name="amount" placeholder="Input a bid amount" style="width:83%" onfocus="if(this.value != '') {this.value=''}">
                {{#if canBid}}
                    <button type="submit" class="btn btn-success">Bid</button>
                {{else}}
                    <button type="submit" disabled class="btn btn-success">Bid</button>
                {{/if}}
            </form>
            {{else}}
                <form class="form-inline bid-on-player" role="form">
                        <input type="text" disabled name="amount" class="form-control" placeholder="Insufficient Funds" style="width:83%">
                        <button type="submit" disabled class="btn btn-danger">Bid</button>
                </form>
            {{/if}}
        {{/if}}
        </div>
        </div>
        </div>
    </div>
    {{/if}}
</template>

<template name="display_time">
    <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
        <div class="panel panel-default" style="height:90px;">
        <div class="panel-heading" style="text-align:center">
            {{#if isNominationTime}}
                <h2 class="panel-title">Awaiting nomination from {{currentNominatingPlayer}}</h2>
            {{else}}
                <h2 class="panel-title">{{personBeingBidOn}} - <b id="timeRemaining">{{time}}</b></h2>
            {{/if}}
        </div>
        {{#if isNominationTime}}
        {{else}}
            <div class="panel-body" style="text-align:center">
            <h4 class="panel-title">{{lastBidder}} bid {{bidAmount}}</h4>
            </div>
        {{/if}}

        </div>
        </div>
    </div>
</template>


